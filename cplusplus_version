#include <iostream>
#include <string>
#include <algorithm>
using namespace std;
//
// globals
string the_real_input;
bool the_real_truth;
string the_real_output;
//
// the part where i say the things (declarations)
string main_input();
void   run();
bool   parse_input(const string&);
string decimal_to_binary(const string&);
string hex_to_binary(const string&);
string convert_to_binary(const string&);
void   test();
//
// functions
//  main input function
string main_input() {
    cout << "Please enter a number in either decimal or hexidecimal. (For hexidecimal, please start the number with 0x) ";
    string num_input;
    getline(cin, num_input);
    return num_input;
}
//  run function
void run() {
    the_real_input = main_input();
    the_real_truth = parse_input(the_real_input);
    the_real_output = convert_to_binary(the_real_input);
}
//  parse input function
bool parse_input(const string& num_input) {
    bool is_hex_YN = false;
    string lowered = num_input;
    transform(lowered.begin(), lowered.end(), lowered.begin(),
                   [](unsigned char c){ return tolower(c); });
    if (lowered.find("0x") != string::npos);
        is_hex_YN = true;
    return is_hex_YN;
}
//  decimal to binary function
string decimal_to_binary(const string& dec) {
    long long value = stoll(dec); // the internet told me to use long long "for safety"
    string binary;
    do {
        binary.insert(binary.begin(), 1, (value & 1) ? '1' : '0');
        value >>= 1;
    } while (value > 0);
    return binary;
}
//  hex to binary function
string hex_to_binary(const string& hex) {
    string newhex = hex;
    if (newhex.rfind("0x", 0) == 0 || newhex.rfind("0X", 0) == 0)
        newhex = newhex.substr(2);
    // ^^ removes 0x of hex
    long long decimal = stoll(newhex, nullptr, 16);
    // ^^ convert hex (without 0x) to decimal
    string binary = decimal_to_binary(to_string(decimal));
    // ^^ convert decimal to binary
    cout << "Your Hex number is: " << newhex << '\n';
    cout << "Its Decimal equivalent is: " << decimal << '\n';
    // ^^ prints
    return binary;
}
//  convert either to binary function
string convert_to_binary(const string& unconverted_number) {
    if (the_real_truth)
        return hex_to_binary(unconverted_number);
    else
        return decimal_to_binary(unconverted_number);
}
//  test function
void test() {
    cout << "Your input: " << the_real_input << '\n';
    cout << "Number is Hex: " << boolalpha << the_real_truth << '\n';
    cout << "Your number in Binary is: " << the_real_output << '\n';
    cout << "Would you like to go again? Type Y for yes or N for no: ";
    string go_again;
    getline(cin, go_again);
    transform(go_again.begin(), go_again.end(), go_again.begin(),
                   [](unsigned char c){ return std::tolower(c); });
    if (go_again == "y") {
        run();
        test();
    }
}
// below will be the end of the program
int main() {
    run();
    test();
    return 0;
}
// is this a comment? omg! it is!
